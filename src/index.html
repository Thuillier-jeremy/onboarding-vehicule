<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Préparation dossier véhicule</title>

  <style>
    body{
      font-family: Arial, sans-serif;
      margin:0;
      background:#0f0f12;
      color:#fff;
    }

    .wrap{
      max-width:720px;
      margin:0 auto;
      padding:18px;
    }

    /* LOGO */
    .logo{
      display:flex;
      justify-content:center;
      margin:20px 0 10px;
    }

    .logo img{
      max-width:260px;
      width:min(70%,260px);
      height:auto;
    }

    .card{
      background:#17181d;
      border:1px solid #2a2b33;
      border-radius:14px;
      padding:16px;
      margin:12px 0;
    }

    h1{
      font-size:20px;
      margin:6px 0 10px;
    }

    label{
      display:block;
      margin:10px 0 6px;
      font-size:14px;
      opacity:.9;
    }

    input, textarea, button{
      width:100%;
      padding:12px;
      border-radius:12px;
      border:1px solid #2a2b33;
      background:#0f0f12;
      color:#fff;
      box-sizing:border-box;
    }

    textarea{
      resize:vertical;
      min-height:80px;
    }

    input[type="file"]{
      padding:10px;
    }

    .hint{
      font-size:12px;
      opacity:.75;
      margin-top:6px;
      line-height:1.35;
    }

    .row{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }

    @media (max-width:640px){
      .row{ grid-template-columns:1fr; }
    }

    button{
      cursor:pointer;
      border:none;
      background:#3b82f6;
      font-weight:700;
      margin-top:10px;
    }

    button:disabled{
      opacity:.6;
      cursor:not-allowed;
    }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- LOGO -->
    <div class="logo">
      <img src="/assets/logo-bernier-blanc.png" alt="Groupe Bernier">
    </div>

    <!-- TITRE -->
    <div class="card">
      <h1>Préparation de votre dossier atelier</h1>
      <div class="hint">
        Merci d’envoyer :
        <b>1 photo de la carte grise</b> +
        <b>des photos des dégâts du véhicule</b>.<br>
        Astuce : photos nettes, véhicule bien éclairé.
      </div>
    </div>

    <!-- FORMULAIRE (Azure) -->
    <form id="onboardingForm" class="card" enctype="multipart/form-data">

      <!-- DATE EXPERTISE -->
      <label for="date_expertise">
        Date de votre RDV d'expertise confirmé avec votre assurance et / ou le cabinet d'expertise *
      </label>
      <input id="date_expertise" name="date_expertise" type="date" required>
      <div class="hint">Sélectionnez la date de rendez-vous.</div>

      <div class="row">
        <div>
          <label for="nom">Nom / Prénom *</label>
          <input id="nom" name="nom" type="text" required>
        </div>
        <div>
          <label for="tel">Téléphone *</label>
          <input id="tel" name="telephone" type="tel" required>
        </div>
      </div>

      <!-- EMAIL -->
      <label for="email">Adresse e-mail *</label>
      <input id="email" name="email" type="email" placeholder="exemple@email.fr" required>

      <!-- ADRESSE POSTALE -->
      <label for="adresse">Adresse postale complète *</label>
      <textarea id="adresse" name="adresse_postale" placeholder="N° et rue, code postal, ville" required></textarea>

      <label for="immat">Immatriculation (optionnel)</label>
      <input id="immat" name="immatriculation" type="text" placeholder="AA-123-BB">

      <!-- CARTE GRISE -->
      <label for="cg">Photo de la carte grise *</label>
      <input id="cg" name="carte_grise" type="file" accept="image/*" capture="environment" required>
      <div class="hint">1 photo uniquement.</div>

      <!-- DEGATS (4 photos) -->
      <label>(Optionnel) Afin de préparer votre RDV carrosserie – Photos des dégâts (jusqu’à 4)</label>
      <input name="degat_1" type="file" accept="image/*" capture="environment">
      <input name="degat_2" type="file" accept="image/*" capture="environment">
      <input name="degat_3" type="file" accept="image/*" capture="environment">
      <input name="degat_4" type="file" accept="image/*" capture="environment">

      <!-- HORS SINISTRE (2 photos) -->
      <label>
       Profitez de l’intervention pour corriger d’autres dommages à tarif préférentiel.
       Bénéficiez d’une remise exceptionnelle de 50 %,dans le cadre de cette intervention.
      </label>
      <div class="hint">Optionnel : ajoutez jusqu’à 2 photos.</div>
      <input name="hors_sinistre_1" type="file" accept="image/*" capture="environment">
      <input name="hors_sinistre_2" type="file" accept="image/*" capture="environment">

      <div class="hint">
        Taille maximale conseillée : photos légères (réseau mobile).
      </div>

      <button id="btn" type="submit">Envoyer les photos</button>
      <div id="msg" class="hint" style="margin-top:8px;"></div>
    </form>

    <!-- RGPD -->
    <div class="card">
      <div class="hint">
        Les données et photos transmises sont utilisées uniquement
        dans le cadre de la prise en charge de votre véhicule
        et conservées conformément à la réglementation en vigueur.
      </div>
    </div>

  </div>

  <script>
    const form = document.getElementById("onboardingForm");
    const btn = document.getElementById("btn");
    const msg = document.getElementById("msg");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      btn.disabled = true;
      msg.textContent = "Envoi en cours… merci de patienter.";

      try {
        const formData = new FormData(form);

        // ⚠️ IMPORTANT : adapte si ta function s’appelle sendmail
        const response = await fetch("/api/upload", {
          method: "POST",
          body: formData
        });

        if (!response.ok) {
          const txt = await response.text().catch(() => "");
          throw new Error(txt || "Erreur lors de l’envoi du dossier.");
        }

        window.location.href = "/merci.html";
      } catch (err) {
        btn.disabled = false;
        msg.textContent = "Erreur : " + err.message;
      }
    });
  </script>

</body>
</html>
